<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Getac</title>
    <link href="/static/css/style.css" rel="stylesheet" type="text/css" />
    <script src="js/script.js"></script>
    <style>
        #btnUpdate:disabled {
            background-color: gray;
        }

        #btnUpdate:not(:disabled) {
            background-color: blue;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="upload_form_cont">
            <form id="upload_form" enctype="multipart/form-data" method="post" action="upload.php">
                <div>
                    <h2>
                        <div><label for="image_file">Please select firmware image</label></div>
                    </h2>
                    <div>
                        <input type="file" name="image_file" id="image_file" accept=".tar"
                            onchange="document.getElementById('btnUpdate').disabled = false;" />
                    </div>
                </div>
                <div>
                    <input type="button" id='btnUpdate' value="Update" onclick="startUploading()" disabled />
                </div>

                <div id="progress_info">
                    <div id="progress"></div>
                    <div id="progress_percent">&nbsp;</div>
                    <div class="clear_both"></div>
                    <div>
                        <div id="b_transfered">&nbsp;</div>
                        <div class="clear_both"></div>
                    </div>
                    <div id="upload_response"></div>
                </div>
            </form>
            <div>
                <label style="color: red;">
                    Warning: Please do not power off the device or refresh web page during the update process.
                </label><br>
                <label style="color: black;">
                    Note: Please power off/on manually after you see 'success' message.
                </label>
            </div>
            <img id="preview" />
        </div>
    </div>
</body>
<script>
        var oinfoTimer;
        // Document Ready Event
        $(document).ready(function () {
            console.log("config.html DOM ready! MQTT is connected:" + isMqttConnected);
            if (isMqttConnected == true) {
                defaultTopicSubscribes();
            }
            else
                // set inner timer
                oinfoTimer = setInterval(doInnerChk, 1000);
        });
        function doInnerChk() { // we will use this function to display upload speed
            console.log("doInnerChk() called!")
            if (isMqttConnected == true) {
                defaultTopicSubscribes();
                clearTimeout(oinfoTimer);
            }
        }

        function defaultTopicSubscribes() {
            console.log("defaultTopicSubscribes() called!");
            // Subscribe to the default topic
            subscribeTopic(SUB_FOTA_TOPIC);
        }
</script>
</html>